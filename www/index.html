<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <!-- From here: http://stackoverflow.com/a/4389976 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Voronoi GPU</title>
    <link href='https://fonts.googleapis.com/css?family=Lato:300,700italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="style.css">
    <script src="demo-compiled.js"></script>
  </head>
  <body>
    <div id="demo-page">
      <h1>Voronoi Diagrams on the GPU</h1>

      <hr>

      <p class="disclaimer">
        Disclaimer: the demos on this page use WebGL features that aren't available on many mobile devices. For the best experience, read this on a Desktop computer.
      </p>

      <hr>

      <p>
        This page has a few demos of some code that I wrote to generate Voronoi diagrams. If you're interested, you can find the code <a target="blank_" href="https://github.com/ryankaplan/gpu-voronoi">here</a>.
      </p>

      <p>
        What is a Voronoi diagram? Try the demo below to find out. When you click in the left canvas, you plant a colored 'seed'. In the right canvas, every pixel takes the color of the closest seed.
      </p>

      <div id="paint-demo-container" class="demo-container">
        <canvas class="input-canvas"></canvas>
        <canvas class="output-canvas"></canvas>
      </div>

      <p>
        Here's another demo that's slightly more interactive. Move your mouse over either canvas.
      </p>

      <div id="fish-demo-container" class="demo-container">
        <canvas class="input-canvas"></canvas>
        <canvas class="output-canvas"></canvas>
      </div>

      <p>
        And below is one more example. In the left canvas there are seeds in a radial pattern overlaid on top of a photo. Each seed takes the color of the underlying pixel in the image. Move the circle to move the seeds and move the square to rotate them.
      </p>

      <div id="photo-demo-container" class="demo-container">
        <div class="input-canvas-container">
          <img id="eye" src="eye.jpg"></img>
          <canvas class="input-canvas"></canvas>
        </div>
        <canvas class="output-canvas"></canvas>
      </div>

      <h2>
        How does this work?
      </h2>

      <p>
        There are a few other popular algorithms for computing Voronoi diagrams. If you're interested in a survey you can read <a href="http://www.alanzucconi.com/2015/02/24/to-voronoi-and-beyond/" target="blank_">this article</a>. But I'll talk about one that I used above. I think it's really cool and it's called Jump Flooding.
      </p>

      <p>
        There's a really simple way of computing Voronoi diagrams: for every pixel in an image, look through every seed and take the color of the closest one. This works fine but it gets slow when you have lots of seeds. You can picture it searching radially outward for every pixel, like in the gif below.
      </p>

      <div style="width: 100%; text-align: center;">
        <img src="naive.gif" alt="" />
      </div>

      <p>
          Each pixel looks at its neighbours to see if there are any seeds. Then it looks to those neighbours neighbours, and so on. At each pixel it compares its distance to the distance of the closest known seed. When you've searched all pixels in the grid, you have the location of the closest seed.
      </p>

      <p>
          Jump Flooding is similar to this. It just uses a more efficient searching pattern. Instead of searching in rings around our current pixel, it shoots rays out of the current pixel in a radial pattern. The first step looks at the neighbouring 8 pixels, just like the naive approach above. But the second step - instead of searching 16 new pixels like the naive approach - searches just 8 pixels again, each slightly further from the original pixel. And the third step - instead of 32 pixels - searches 8 pixels again. You get the idea. Here's a gif.
      </p>

      <div style="width: 100%; text-align: center;">
        <img src="jump-flood.gif" alt="" />
      </div>

      <h2>
          Other Applications of Jump Flooding
      </h2>

      <p>
        In the demos up top we use the Jump Flooding algorithm to draw Voronoi diagrams. For each pixel we calculate the color of the closest seed and the distance to the closest seed. The Jump Flooding algorithm gives us something else that we didn't draw: the distance to the closest seed. Below is a demo where the color of the pixel changes based on the distance to the closest seed. Bright pixels are close to a seed and dark pixels are far from a seed.
      </p>

      <div id="distance-demo-container" class="demo-container">
        <canvas class="input-canvas"></canvas>
        <canvas class="output-canvas"></canvas>
      </div>

      <p>
        We can use this to implement 'outlines' on shapes. Below is a demo of a rectangle - you can drag it to move it around. In the right canvas, we've run the Jump Flooding algorithm and we draw pixels that are within 10px of an seed (aka any pixel in the square). What we get is a square with an outline.
      </p>

      <div id="threshold-demo-container" class="demo-container">
        <canvas class="input-canvas"></canvas>
        <canvas class="output-canvas"></canvas>
      </div>

    </div>
    <div id="webgl-error" style="display: none;">
      This webpage uses WebGL which isn't supported by your browser. <br />
      </br>
      Sorry :(
    </div>
  </body>
</html>