(function(){var ga=Math.imul||function(a,b){return (a*(b>>>16)<<16)+a*(b&65535)|0};var x;function l(a,b){var c=a.getElementsByClassName(b)[0];return c.width=c.height=256,c}function q(a,b){var c=null;try{c=new oa(a,b)}catch(d){document.getElementById('demo-page').style.display='none',document.getElementById('webgl-error').style.display=null;throw d}return c}function L(a){var b=l(a,'input-canvas'),c=l(a,'output-canvas'),d=q(c,256),e=new ia(b);e.g=function(){t(d,b),u(d),s(d)}}function M(a){var b=l(a,'input-canvas'),c=l(a,'output-canvas'),d=q(c,256),e=new ka(b);e.c=function(){t(d,b),u(d),s(d)}}function N(a){var b=l(a,'input-canvas'),c=l(a,'output-canvas'),d=q(c,256),e=new ma(b);e.j=function(){t(d,e.c),u(d),s(d)}}function ha(){window.onload=function(){L(document.getElementById('paint-demo-container')),M(document.getElementById('fish-demo-container')),N(document.getElementById('photo-demo-container'))}}function X(a,b){var c=a.getExtension(b);if(!c)throw new Error('Unsupported WebGL extension with name '+b);return c}
function F(a,b){return a-b*Math.floor(a/b)}function r(b,a){b.b.beginPath(),b.b.rect(a.a-b.e|0,a.b-b.e|0,b.e<<1,b.e<<1),b.b.fillStyle=D(O[b.d]),b.b.fill(),b.g&&b.g()}function P(b,a){a.style.backgroundColor='white',a.width=a.height=256}function y(b,a){a.beginPath(),a.rect(b.a.a-b.b/2|0,b.a.b-b.b/2|0,b.b|0,b.b|0),a.fillStyle=D(b.c),a.fill(),a.closePath()}function R(e){var a=null,b=function(){var c=new Date,d=a?+c-+a:1/30;S(e,d/1000),a=c,requestAnimationFrame(b)};requestAnimationFrame(b)}function S(e,a){e.b.clearRect(0,0,e.a.width,e.a.height);for(var b=1,g=e.e.length;b<g;b=b+1|0){var c=e.e[b];ca(c.a,e.g[b]*a),ba(c.a,new qa(e.a.width,e.a.height))}for(var i=0,h=e.e,j=h.length;i<j;i=i+1|0){var d=h[i];y(d,e.b)}y(e.i,e.b),e.c&&e.c()}function z(b,a){W(b.a),B(b.a),V(b,new qa(a.offsetX,a.offsetY)),b.a.j()}function T(c,a){var b=c.a.c.width;a.a>0&&a.b>0&&a.a<b&&a.b<b&&C(c.a,a)}function U(i,a,b,c){for(var d=0;d<c;d++){var e=b*Math.cos(d/c*3.141592653589793*2),g=b*Math.sin(d/c*3.141592653589793*2);T(i,aa(a,new qa(e,g)))}}function V(e,a){
for(var b=0;b<100;b=b+1|0){var c=b,d=ga(ga(b,b),3)/10|0;U(e,a,d,c)}}function A(d,a,b,c){a.beginPath(),a.rect(b.a-d.h|0,b.b-d.h|0,d.h<<1,d.h<<1),a.fillStyle=c,a.fill()}function W(a){a.d.clearRect(0,0,a.c.width,a.c.height)}function B(a){a.b.drawImage(a.e,0,0)}function C(b,a){A(b,b.b,a,'rgba(255, 255, 255, 0.5)'),A(b,b.d,a,b.g)}function D(a){return 'rgba('+(a.a*255|0)+', '+(a.b*255|0)+', '+(a.c*255|0)+', '+a.d+')'}function E(a,b){if(a<0||a>255)throw new Error('First parameter '+a+' is out of bounds. Must be between 0 and 255.');if(b<0||b>255)throw new Error('Second parameter '+b+' is out of bounds. Must be between 0 and 255.');return (a<<8)+b|0}function f(a){return new na((a>>16&255)/255|0,(a>>8&255)/255,(a&255)/255,1)}function s(a){a.a.defaultFramebuffer.bind(),a.i.bind(0),a.a.gl.viewport(0,0,a.n.width,a.n.height),a.p.use().attrib('quad',a.e,2).uniformi('iCellGridTexture',0).uniform('iCanvasSize',new Float32Array([a.n.width,a.n.height])).uniform('iGridSize',new Float32Array([a.b,a.b])).uniform('iRelease',!0,!0).draw(5,
4)}function t(c,a){c.j.attach(c.g);var b=c.a.gl;b.bindTexture(3553,c.h.texture),b.texImage2D(3553,0,6408,6408,5121,a),c.h.bind(0),c.a.gl.viewport(0,0,c.b,c.b),c.d.use().attrib('quad',c.e,2).uniformi('iCellGridTexture',0).uniform('iCellGridSize',new Float32Array([c.b,c.b])).uniform('iBackgroundColor',new Float32Array([0,0,0,0])).draw(5,4)}function Y(j,a){for(var b=new Float32Array(j.b*j.b<<2),c=0,m=b.length;c<m;c=c+1|0)b[c]=-1;for(var d=0,p=a.length;d<p;d=d+1|0){var e=a[d],g=(e.a.b*j.b+e.a.a)*4|0,i=E(e.b.a*255|0,e.b.b*255|0),h=E(e.b.c*255|0,e.b.d*255|0);b[g]=i,b[g+1|0]=h,b[g+2|0]=e.a.a,b[g+3|0]=e.a.b}j.g.subset(b,0,0,j.b,j.b)}function u(b){for(var a=b.b/2|0;a>0;)v(b,a),a=a/2|0;v(b,2),v(b,1)}function v(b,a){b.j.attach(b.i),b.g.bind(0),b.a.gl.viewport(0,0,b.b,b.b),b.c.use().attrib('quad',b.e,2).uniformi('iCellGridTexture',0).uniformi('iStepSize',a).uniform('iCellGridSize',new Float32Array([b.b,b.b])).draw(5,4),Z(b)}function Z(b){var a=b.g;b.g=b.i,b.i=a}function _(a,b){return new pa(new qa(a.a*Math.random(),a.b*Math.random()),
b[Math.random()*b.length|0])}function $(a,b,c){for(var d=[],e=0;e<c;e=e+1|0)d.push(_(a,b));return d}function aa(b,a){return new qa(b.a+a.a,b.b+a.b)}function ba(b,a){b.a=F(b.a,a.a),b.b=F(b.b,a.b)}function ca(b,a){b.a+=a,b.b+=a}function k(a,b,c){a.addEventListener(b,c)}function o(a){try{return a.getContext('2d')}catch(b){}return null}function ia(a){var g=this;g.b=null,g.c=!1,g.d=0,g.e=1,g.g=null,g.a=a,P(g,a),g.b=o(g.a),k(document,'keyup',function(b){b.which^67||(g.d=(g.d+1|0)%O.length|0)}),k(g.a,'mousedown',function(c){g.c=!0,c.stopPropagation(),r(g,new qa(c.offsetX,c.offsetY))}),k(g.a,'mousemove',function(d){g.c&&r(g,new qa(d.offsetX,d.offsetY)),d.stopPropagation()}),k(g.a,'mouseup',function(e){r(g,new qa(e.offsetX,e.offsetY)),g.c=!1,e.stopPropagation()})}function ja(a){this.a=a,this.b=2,this.c=new na(0,0,1,1)}function ka(a){var d=this;d.a=d.b=d.c=null,d.d=40,d.e=[],d.g=[],d.i=null,d.a=a,d.b=o(d.a);for(var b=1,e=d.d;b<e;b=b+1|0)d.e.push(new ja(new qa(Math.random()*d.a.width,Math.random()*d.a.height))),d.e[d.e.length-1|0].c=Q[b%Q.length|0],
d.g.push(10+Math.random()*4);d.i=new ja(new qa(Math.random()*d.a.width,Math.random()*d.a.height)),d.i.c=f(16771345),k(a,'mousemove',function(c){d.i.a.a=c.offsetX,d.i.a.b=c.offsetY}),R(d)}function la(a){this.a=a,this.b=!1}x=la.prototype;x.I=function(a){this.b=!0,a.stopPropagation(),z(this,a)};x.J=function(a){this.b&&z(this,a),a.stopPropagation()};x.K=function(a){C(this.a,new qa(a.offsetX,a.offsetY)),this.b=!1,a.stopPropagation()};function ma(a){var h=this;h.a=h.b=h.c=h.d=h.e=h.g=null,h.i=!1,h.h=1,h.j=null,h.m=[],h.a=a,h.b=o(h.a),a.width=a.height=256,h.c=document.createElement('canvas'),h.d=o(h.c),h.c.width=h.a.width,h.c.height=h.a.height,h.e=document.getElementById('eye'),h.g=h.d.createPattern(h.e,'repeat'),B(h),k(h.a,'mousedown',function(b){for(var j=0,m=h.m,p=m.length;j<p;j=j+1|0){var c=m[j];c.I(b)}}),k(h.a,'mousemove',function(d){for(var n=0,G=h.m,da=G.length;n<da;n=n+1|0){var e=G[n];e.J(d)}}),k(h.a,'mouseup',function(g){for(var w=0,H=h.m,ea=H.length;w<ea;w=w+1|0){var i=H[w];i.K(g)}}),h.m=[new la(h)]}function na(a,b,c,d){
this.a=a,this.b=b,this.c=c,this.d=d}function oa(a,b){if(this.a=this.c=this.d=this.e=this.g=this.i=this.h=this.j=this.m=this.p=null,this.b=b,this.n=a,this.a=new Igloo(a),!this.a.gl)throw new Error('Failed to initialize Igloo');this.a.gl.disable(2929),this.p=new Igloo.Program(this.a.gl,'precision highp float;\n\nconst vec4 q = vec4(1.0, 0.0, 0.0, 1.0), m = vec4(0.0, 1.0, 0.0, 1.0), k = vec4(0.0, 0.0, 1.0, 1.0), r = vec4(0.0, 1.0, 1.0, 1.0), o = vec4(1.0, 0.0, 1.0, 1.0), j = vec4(1.0, 1.0, 0.0, 1.0), g = vec4(0.0, 0.0, 0.0, 1.0), l = vec4(1.0, 1.0, 1.0, 1.0);\nattribute vec2 quad;\n\nvoid main() {\n  gl_Position = vec4(quad, 0, 1.0);\n}\n','precision highp float;\n\nuniform sampler2D iCellGridTexture;\nuniform vec2 iGridSize, iCanvasSize;\nuniform int iRelease;\nconst vec4 q = vec4(1.0, 0.0, 0.0, 1.0), m = vec4(0.0, 1.0, 0.0, 1.0), k = vec4(0.0, 0.0, 1.0, 1.0), r = vec4(0.0, 1.0, 1.0, 1.0), o = vec4(1.0, 0.0, 1.0, 1.0), j = vec4(1.0, 1.0, 0.0, 1.0), g = vec4(0.0, 0.0, 0.0, 1.0), l = vec4(1.0, 1.0, 1.0, 1.0);\n\nint A(int a, int b) {\n  return int(mod(float(a), float(b)));\n}\n\nvec2 v(int a) {\n  return vec2(a / 256, A(a, 256));\n}\n\nbool e(float a, float b) {\n  return abs(a - b) < 1e-4;\n}\n\nbool t(vec2 a, vec2 b, vec2 c) {\n  return a.x > b.x && a.x < c.x && a.y > b.y && a.y < c.y;\n}\n\nvec2 y(vec2 b) {\n  vec2 a = gl_FragCoord.xy / iCanvasSize;\n  return vec2(0.0, 0.0) + iGridSize * a;\n}\n\nbool h(vec2 a) {\n  return a.x >= 0.0 && a.y >= 0.0 && a.x <= 1.0 && a.y <= 1.0;\n}\n\nvec4 C(const vec4 a) {\n  int b = int(a.x), c = int(a.y);\n  return vec4(v(b), v(c)) / 255.0;\n}\n\nbool i(const vec4 a) {\n  return!e(a.y, -1.0);\n}\n\nvoid B(vec2 a) {\n  if (iRelease == 1)\n    return;\n  vec4 b = vec4(1.0, 0.5, 0.5, 1.0), c = vec4(0.5, 0.5, 1.0, 1.0), f = vec4(0.5, 1.0, 0.5, 1.0);\n  if (mod(a.x, 100.0) < 3.0 || mod(a.y, 100.0) < 3.0)\n    gl_FragColor = (b + gl_FragColor) / 2.0;\n  if (t(a.xy, vec2(0.0, 0.0), vec2(10.0, 10.0)))\n    gl_FragColor = (f + gl_FragColor) / 2.0;\n  if (t(a.xy, vec2(100.0, 100.0), vec2(110.0, 110.0)))\n    gl_FragColor = (c + gl_FragColor) / 2.0;\n}\n\nvoid main() {\n  vec2 a = y(gl_FragCoord.xy), b = a / iGridSize;\n  if (!h(b)) {\n    gl_FragColor = g, B(a);\n    return;\n  }\n  vec4 c = texture2D(iCellGridTexture, b);\n  if (!i(c))\n    discard;\n  else\n    gl_FragColor = C(c);\n}\n');
var c=this.a.gl;X(c,'OES_texture_float'),c.disable(2929),this.c=new Igloo.Program(this.a.gl,'precision highp float;\n\nconst vec4 q = vec4(1.0, 0.0, 0.0, 1.0), m = vec4(0.0, 1.0, 0.0, 1.0), k = vec4(0.0, 0.0, 1.0, 1.0), r = vec4(0.0, 1.0, 1.0, 1.0), o = vec4(1.0, 0.0, 1.0, 1.0), j = vec4(1.0, 1.0, 0.0, 1.0), g = vec4(0.0, 0.0, 0.0, 1.0), l = vec4(1.0, 1.0, 1.0, 1.0);\nattribute vec2 quad;\n\nvoid main() {\n  gl_Position = vec4(quad, 0, 1.0);\n}\n','precision highp float;\n\nuniform sampler2D iCellGridTexture;\nuniform vec2 iCellGridSize;\nuniform int iStepSize;\nconst vec4 q = vec4(1.0, 0.0, 0.0, 1.0), m = vec4(0.0, 1.0, 0.0, 1.0), k = vec4(0.0, 0.0, 1.0, 1.0), r = vec4(0.0, 1.0, 1.0, 1.0), o = vec4(1.0, 0.0, 1.0, 1.0), j = vec4(1.0, 1.0, 0.0, 1.0), g = vec4(0.0, 0.0, 0.0, 1.0), l = vec4(1.0, 1.0, 1.0, 1.0);\n\nbool e(float a, float b) {\n  return abs(a - b) < 1e-4;\n}\n\nbool h(vec2 a) {\n  return a.x >= 0.0 && a.y >= 0.0 && a.x <= 1.0 && a.y <= 1.0;\n}\n\nvec4 n() {\n  return vec4(-1.0, -1.0, -1.0, -1.0);\n}\n\nvec2 s(const vec4 a) {\n  return vec2(a.z, a.w);\n}\n\nbool i(const vec4 a) {\n  return!e(a.y, -1.0);\n}\n\nvec4 d(const vec4 a, const vec2 f) {\n  vec2 c = (gl_FragCoord.xy + f) / iCellGridSize;\n  vec4 b = h(c) ? texture2D(iCellGridTexture, c) : n();\n  if (!i(b))\n    return a;\n  else if (!i(a))\n    return b;\n  else {\n    vec2 p = s(a), x = s(b);\n    if (distance(p, gl_FragCoord.xy) > distance(x, gl_FragCoord.xy))\n      return b;\n  }\n  return a;\n}\n\nvoid main() {\n  vec2 b = gl_FragCoord.xy / iCellGridSize;\n  if (!h(b))\n    discard;\n  vec4 a = texture2D(iCellGridTexture, b);\n  a = d(a, vec2(0, iStepSize)), a = d(a, vec2(iStepSize, iStepSize)), a = d(a, vec2(iStepSize, 0)), a = d(a, vec2(iStepSize, -iStepSize)), a = d(a, vec2(0, -iStepSize)), a = d(a, vec2(-iStepSize, -iStepSize)), a = d(a, vec2(-iStepSize, 0)), a = d(a, vec2(-iStepSize, iStepSize)), gl_FragColor = a;\n}\n'),
this.d=new Igloo.Program(this.a.gl,'precision highp float;\n\nconst vec4 q = vec4(1.0, 0.0, 0.0, 1.0), m = vec4(0.0, 1.0, 0.0, 1.0), k = vec4(0.0, 0.0, 1.0, 1.0), r = vec4(0.0, 1.0, 1.0, 1.0), o = vec4(1.0, 0.0, 1.0, 1.0), j = vec4(1.0, 1.0, 0.0, 1.0), g = vec4(0.0, 0.0, 0.0, 1.0), l = vec4(1.0, 1.0, 1.0, 1.0);\nattribute vec2 quad;\n\nvoid main() {\n  gl_Position = vec4(quad, 0, 1.0);\n}\n','precision highp float;\n\nuniform sampler2D iCellGridTexture;\nuniform vec2 iCellGridSize;\nuniform vec4 iBackgroundColor;\nconst vec4 q = vec4(1.0, 0.0, 0.0, 1.0), m = vec4(0.0, 1.0, 0.0, 1.0), k = vec4(0.0, 0.0, 1.0, 1.0), r = vec4(0.0, 1.0, 1.0, 1.0), o = vec4(1.0, 0.0, 1.0, 1.0), j = vec4(1.0, 1.0, 0.0, 1.0), g = vec4(0.0, 0.0, 0.0, 1.0), l = vec4(1.0, 1.0, 1.0, 1.0);\n\nint u(int a, int b) {\n  return a * 256 + b;\n}\n\nbool e(float a, float b) {\n  return abs(a - b) < 1e-4;\n}\n\nbool w(vec4 a, vec4 b) {\n  return e(a.x, b.x) && e(a.y, b.y) && e(a.z, b.z) && e(a.w, b.w);\n}\n\nvec4 z(float a, float b, vec2 c) {\n  return vec4(a, b, c);\n}\n\nvec4 n() {\n  return vec4(-1.0, -1.0, -1.0, -1.0);\n}\n\nvoid main() {\n  vec2 b = gl_FragCoord.xy / iCellGridSize, c = vec2(b.x, 1.0 - b.y);\n  vec4 a = texture2D(iCellGridTexture, c);\n  if (w(a, iBackgroundColor))\n    gl_FragColor = n();\n  else {\n    int f = u(int(a.r * 255.0), int(a.g * 255.0)), p = u(int(a.b * 255.0), int(a.a * 255.0));\n    gl_FragColor = z(float(f), float(p), gl_FragCoord.xy);\n  }\n}\n'),
this.e=this.a.array(Igloo.QUAD2),this.g=this.a.texture(null,6408,10497,9728,5126).blank(b,b),this.i=this.a.texture(null,6408,10497,9728,5126).blank(b,b),this.h=this.a.texture(null,6408,10497,9728,5121).blank(b,b),this.j=this.a.framebuffer(),Y(this,$(new qa(256,256),fa,200))}function pa(a,b){this.a=a,this.b=b}function qa(a,b){this.a=a,this.b=b}var O=[f(7667884),f(14373119),f(5046527),f(9651967),f(10042034),f(4150527),f(233724),f(16777215)],Q=[f(7051762),f(4814543),f(8428277),f(8305894),f(9011445),f(970239),f(5611513)],fa=[f(7112959),f(4379135),f(12075479),f(9971199),f(6225916),f(4849577),f(8285951),f(10551246),f(15226111)];ha()})();
