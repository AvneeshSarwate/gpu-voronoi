(function(){var oa=Math.imul||function(a,b){return (a*(b>>>16)<<16)+a*(b&65535)|0};var E;function p(a,b,c,e){var d=a.getElementsByClassName(b)[0];return d.width=d.height=c,d.style.width=d.style.height=e+'px',d}function t(a,b){var c=null;try{c=new xa(a,b)}catch(e){document.getElementById('demo-page').style.display='none',document.getElementById('webgl-error').style.display=null;throw e}return c}function u(a,b){var c=a.getBoundingClientRect();return new za(b.a/c.width*a.width,b.b/c.height*a.height)}function q(a,b){return u(a,new za(b.offsetX,b.offsetY))}function V(a){var b=p(a,'input-canvas',512,256),c=p(a,'output-canvas',512,256),e=new ya,d=t(c,e);new qa(b,c,function(){x(d,b),y(d),w(d)})}function W(a){var b=p(a,'input-canvas',512,256),c=p(a,'output-canvas',512,256),e=new ya;e.a=!0;var d=t(c,e);new sa(b,c,function(){x(d,b),y(d),w(d)})}function X(a){var b=p(a,'input-canvas',512,256),c=p(a,'output-canvas',512,256),e=new ya,d=t(c,e);new va(b,c,function(h){x(d,h.e),y(d),w(d)})}function pa(){window.onload=function(){
V(document.getElementById('paint-demo-container')),W(document.getElementById('fish-demo-container')),X(document.getElementById('photo-demo-container'))}}function ba(a,b){var c=a.getExtension(b);if(!c)throw new Error('Unsupported WebGL extension with name '+b);return c}function ca(a){return a!=0&&(a&a-1)==0}function M(a,b){return a-b*Math.floor(a/b)}function v(b,a){a.a>0&&a.b>0&&a.a<b.a.width&&a.b<b.a.height&&(b.e=new wa(.5+Math.random()*.4,.2,.3+Math.random()*.5,1),b.c.beginPath(),b.c.rect(a.a-b.h|0,a.b-b.h|0,b.h<<1,b.h<<1),b.c.fillStyle=L(b.e),b.c.fill(),b.f&&b.f())}function F(b,a){a.beginPath(),a.rect(b.a.a-(b.b/2|0)|0,b.a.b-(b.b/2|0)|0,b.b,b.b),a.fillStyle=L(b.c),a.fill(),a.closePath()}function Z(d){var a=null,b=function(){var c=new Date,e=a?+c-+a:1/30;_(d,e/1000),a=c,requestAnimationFrame(b)};requestAnimationFrame(b)}function _(d,a){d.c.clearRect(0,0,d.a.width,d.a.height);for(var b=1,h=d.h.length;b<h;b=b+1|0){var c=d.h[b];c.a.a+=d.f[b]*a,c.a.b-=d.f[b]*a,ga(c.a,new za(d.a.width,d.a.height))}for(var f=0,j=d.h,l=j.length;f<l;f=f+1|0){
var e=j[f];F(e,d.c)}F(d.j,d.c),d.e&&d.e()}function G(e){aa(e.a);for(var a=ja(s(e.e,e.d)),d=0,h=e.b,f=h.length;d<f;d=d+1|0){var b=h[d],c=O(b);ha(c,Math.max(N(s(e.d,e.e))/50*2,.5)),c=ia(c,a),fa(c,u(e.a.a,e.d)),$(e,c)}H(e,e.e,'#EEEEEE',8),H(e,e.d,'#EEEEEE',15),e.a.l(e.a)}function H(h,a,b,c){var e=u(h.a.a,a),d=h.a.c;d.beginPath(),d.arc(e.a,e.b,c,0,6.283185307179586),d.fillStyle=b,d.fill(),d.lineWidth=4,d.strokeStyle='#222222',d.stroke()}function I(c,a){switch(c.c.a){case 0:var b=s(c.e,c.d);c.d=new za(a.offsetX,a.offsetY),c.e=ea(c.d,b);break;case 1:c.e=new za(a.offsetX,a.offsetY);break}G(c)}function $(c,a){var b=c.a.e.width;a.a>0&&a.b>0&&a.a<b&&a.b<b&&K(c.a,a)}function J(d,a,b,c,e){a.beginPath(),a.rect(b.a|0,b.b|0,e,e),a.fillStyle=c,a.fill()}function aa(a){a.c.clearRect(0,0,a.a.width,a.a.height),a.d.clearRect(0,0,a.e.width,a.e.height)}function K(b,a){J(b,b.c,a,'rgba(255, 255, 255, 0.5)',4),J(b,b.d,a,b.f,1)}function L(a){return 'rgba('+(a.a*255|0)+', '+(a.b*255|0)+', '+(a.c*255|0)+', '+a.e+')'}function i(a){return new wa((a>>16&255)/255|0,
(a>>8&255)/255,(a&255)/255,1)}function w(a){a.b.defaultFramebuffer.bind(),a.j.bind(0),a.b.gl.viewport(0,0,a.o.width,a.o.height),a.n.use().attrib('quad',a.h,2).uniformi('iCellGridTexture',0).uniform('iCanvasSize',new Float32Array([a.o.width,a.o.height])).uniform('iGridSize',new Float32Array([a.c,a.c])).uniform('iRelease',!0,!0).draw(5,4)}function x(c,a){c.m.attach(c.f);var b=c.b.gl;b.bindTexture(3553,c.l.texture),b.texImage2D(3553,0,6408,6408,5121,a),c.l.bind(0),c.b.gl.viewport(0,0,c.c,c.c),c.d.use().attrib('quad',c.h,2).uniformi('iCellGridTexture',0).uniform('iCellGridSize',new Float32Array([c.c,c.c])).uniform('iBackgroundColor',new Float32Array([0,0,0,0])).draw(5,4)}function y(b){for(var a=b.c/2|0;a>0;)z(b,a),a=a/2|0;z(b,2),z(b,1)}function z(b,a){b.m.attach(b.j),b.f.bind(0),b.b.gl.viewport(0,0,b.c,b.c),b.e.use().attrib('quad',b.h,2).uniformi('iCellGridTexture',0).uniformi('iStepSize',a).uniform('iCellGridSize',new Float32Array([b.c,b.c])).uniformi('iUseTorusDistanceForSeeds',b.a.a?1:0).draw(5,4),da(b)}function da(b){
var a=b.f;b.f=b.j,b.j=a}function ea(b,a){return new za(b.a+a.a,b.b+a.b)}function s(b,a){return new za(b.a-a.a,b.b-a.b)}function fa(b,a){b.a+=a.a,b.b+=a.b}function ga(b,a){b.a=M(b.a,a.a),b.b=M(b.b,a.b)}function ha(b,a){b.a*=a,b.b*=a}function ia(b,a){return new za(b.a*Math.cos(a)-b.b*Math.sin(a),b.b*Math.cos(a)+b.a*Math.sin(a))}function ja(a){return Math.atan2(a.b,a.a)}function N(a){return Math.sqrt(a.a*a.a+a.b*a.b)}function O(a){return new za(a.a,a.b)}function k(a,b,c){a.addEventListener(b,c)}function r(a){try{return a.getContext('2d')}catch(b){}return null}function qa(a,b,c){var g=this;g.c=g.e=null,g.d=0,g.h=2,g.a=a,g.b=b,g.f=c,g.a.style.backgroundColor='white',g.c=r(g.a),k(document,'keyup',function(e){e.which^67||(g.d=(g.d+1|0)%na.length|0)});var d=!1;k(document,'mousedown',function(h){d=!0,v(g,q(g.a,h))});for(var n=0,o=[g.a,g.b],D=o.length;n<D;n=n+1|0){var f=o[n];k(f,'mousemove',function(j){d&&v(g,q(g.a,j))})}k(document,'mouseup',function(l){d=!1}),k(document,'mouseleave',function(m){d=!1}),v(g,new za(g.a.width/2|0,
g.a.height/2|0))}function ra(a){this.a=a,this.b=4,this.c=new wa(0,0,1,1)}function sa(a,b,c){var f=this;f.a=f.b=f.c=f.e=null,f.d=40,f.h=[],f.f=[],f.j=null,f.a=a,f.b=b,f.e=c,f.c=r(f.a);for(var e=1,j=f.d;e<j;e=e+1|0)f.h.push(new ra(new za(Math.random()*f.a.width,Math.random()*f.a.height))),f.h[f.h.length-1|0].c=Y[e%Y.length|0],f.f.push(15+Math.random()*8);f.j=new ra(new za(Math.random()*f.a.width,Math.random()*f.a.height)),f.j.c=i(16771345);for(var l=0,m=[f.a,f.b],g=m.length;l<g;l=l+1|0){var d=m[l];k(d,'mousemove',function(h){f.j.a=q(d,h)})}Z(f)}function ta(a){this.a=null,this.b=[],this.c=null,this.e=new za(0,0),this.d=new za(0,0),this.a=a;var b=this.a.a.getBoundingClientRect(),c=new za(b.width,b.height);this.d=new za(c.a/2,c.b/2),this.e=O(this.d),this.e.b-=50;for(var e=0;e<20;e=e+1|0)for(var d=oa(e,e),h=0;h<10;h++){var f=d*Math.cos(h/10*3.141592653589793*2),j=d*Math.sin(h/10*3.141592653589793*2);f+=Math.random()*30-15,j+=Math.random()*30-15,this.b.push(new za(f,j))}G(this)}E=ta.prototype;E.S=function(a){var b=new za(a.offsetX,
a.offsetY);this.c=N(s(this.e,b))<8?new ua(1):new ua(0),a.stopPropagation(),I(this,a)};E.T=function(a){this.c&&I(this,a),a.stopPropagation()};E.U=function(a){K(this.a,q(this.a.a,a)),this.c=null,a.stopPropagation()};function va(a,b,c){var g=this;g.a=g.b=g.c=g.e=g.d=g.h=g.f=null,g.j=!1,g.l=null,g.m=[],g.a=a,g.b=b,g.l=c,g.c=r(g.a),g.e=document.createElement('canvas'),g.d=r(g.e),g.e.width=g.a.width,g.e.height=g.a.height,g.h=document.getElementById('eye'),g.f=g.d.createPattern(g.h,'repeat');for(var C=0,R=[g.a,g.b],ma=R.length;C<ma;C=C+1|0){var e=R[C];k(e,'mousedown',function(d){for(var n=0,o=g.m,D=o.length;n<D;n=n+1|0){var h=o[n];h.S(d)}}),k(e,'mousemove',function(f){for(var A=0,P=g.m,ka=P.length;A<ka;A=A+1|0){var j=P[A];j.T(f)}}),k(e,'mouseup',function(l){for(var B=0,Q=g.m,la=Q.length;B<la;B=B+1|0){var m=Q[B];m.U(l)}})}g.m=[new ta(g)]}function wa(a,b,c,e){this.a=a,this.b=b,this.c=c,this.e=e}function xa(a,b){if(this.a=this.b=null,this.c=0,this.e=this.d=this.h=this.f=this.j=this.l=this.m=this.g=this.n=this.o=null,a.width^a.height)throw new Error('JumpFlood canvas parameter must be square. Size is ('+a.width+', '+a.height+')');
if(!ca(a.width))throw new Error('JumpFlood canvas size must be a power of two. Size is '+a.width);if(this.a=b,this.c=a.width,this.o=a,this.b=new Igloo(a),!this.b.gl)throw new Error('Failed to initialize Igloo');this.b.gl.disable(2929),this.n=new Igloo.Program(this.b.gl,'precision highp float;\n\nconst vec4 o = vec4(1.0, 0.0, 0.0, 1.0), j = vec4(0.0, 1.0, 0.0, 1.0), l = vec4(0.0, 0.0, 1.0, 1.0), k = vec4(0.0, 1.0, 1.0, 1.0), r = vec4(1.0, 0.0, 1.0, 1.0), n = vec4(1.0, 1.0, 0.0, 1.0), h = vec4(0.0, 0.0, 0.0, 1.0), p = vec4(1.0, 1.0, 1.0, 1.0);\nattribute vec2 quad;\n\nvoid main() {\n  gl_Position = vec4(quad, 0, 1.0);\n}\n','precision highp float;\n\nuniform sampler2D iCellGridTexture;\nuniform vec2 iGridSize, iCanvasSize;\nuniform int iRelease;\nconst vec4 o = vec4(1.0, 0.0, 0.0, 1.0), j = vec4(0.0, 1.0, 0.0, 1.0), l = vec4(0.0, 0.0, 1.0, 1.0), k = vec4(0.0, 1.0, 1.0, 1.0), r = vec4(1.0, 0.0, 1.0, 1.0), n = vec4(1.0, 1.0, 0.0, 1.0), h = vec4(0.0, 0.0, 0.0, 1.0), p = vec4(1.0, 1.0, 1.0, 1.0);\n\nint C(int a, int b) {\n  return int(mod(float(a), float(b)));\n}\n\nvec2 w(int a) {\n  return vec2(a / 256, C(a, 256));\n}\n\nbool f(float a, float b) {\n  return abs(a - b) < 1e-4;\n}\n\nbool v(vec2 a, vec2 b, vec2 c) {\n  return a.x > b.x && a.x < c.x && a.y > b.y && a.y < c.y;\n}\n\nvec2 A(vec2 b) {\n  vec2 a = gl_FragCoord.xy / iCanvasSize;\n  return vec2(0.0, 0.0) + iGridSize * a;\n}\n\nbool q(vec2 a) {\n  return a.x >= 0.0 && a.y >= 0.0 && a.x <= 1.0 && a.y <= 1.0;\n}\n\nvec4 D(const vec4 a) {\n  int b = int(a.x), c = int(a.y);\n  return vec4(w(b), w(c)) / 255.0;\n}\n\nbool i(const vec4 a) {\n  return!f(a.y, -1.0);\n}\n\nvoid x(vec2 a) {\n  if (iRelease == 1)\n    return;\n  vec4 b = vec4(1.0, 0.5, 0.5, 1.0), c = vec4(0.5, 0.5, 1.0, 1.0), d = vec4(0.5, 1.0, 0.5, 1.0);\n  if (mod(a.x, 100.0) < 3.0 || mod(a.y, 100.0) < 3.0)\n    gl_FragColor = (b + gl_FragColor) / 2.0;\n  if (v(a.xy, vec2(0.0, 0.0), vec2(10.0, 10.0)))\n    gl_FragColor = (d + gl_FragColor) / 2.0;\n  if (v(a.xy, vec2(100.0, 100.0), vec2(110.0, 110.0)))\n    gl_FragColor = (c + gl_FragColor) / 2.0;\n}\n\nvoid main() {\n  vec2 a = A(gl_FragCoord.xy), b = a / iGridSize;\n  if (!q(b)) {\n    gl_FragColor = h, x(a);\n    return;\n  }\n  vec4 c = texture2D(iCellGridTexture, b);\n  if (!i(c))\n    discard;\n  else\n    gl_FragColor = D(c);\n}\n');
var c=this.b.gl;ba(c,'OES_texture_float'),c.disable(2929),this.e=new Igloo.Program(this.b.gl,'precision highp float;\n\nconst vec4 o = vec4(1.0, 0.0, 0.0, 1.0), j = vec4(0.0, 1.0, 0.0, 1.0), l = vec4(0.0, 0.0, 1.0, 1.0), k = vec4(0.0, 1.0, 1.0, 1.0), r = vec4(1.0, 0.0, 1.0, 1.0), n = vec4(1.0, 1.0, 0.0, 1.0), h = vec4(0.0, 0.0, 0.0, 1.0), p = vec4(1.0, 1.0, 1.0, 1.0);\nattribute vec2 quad;\n\nvoid main() {\n  gl_Position = vec4(quad, 0, 1.0);\n}\n','precision highp float;\n\nuniform sampler2D iCellGridTexture;\nuniform vec2 iCellGridSize;\nuniform int iStepSize;\nuniform bool iUseTorusDistanceForSeeds;\nconst vec4 o = vec4(1.0, 0.0, 0.0, 1.0), j = vec4(0.0, 1.0, 0.0, 1.0), l = vec4(0.0, 0.0, 1.0, 1.0), k = vec4(0.0, 1.0, 1.0, 1.0), r = vec4(1.0, 0.0, 1.0, 1.0), n = vec4(1.0, 1.0, 0.0, 1.0), h = vec4(0.0, 0.0, 0.0, 1.0), p = vec4(1.0, 1.0, 1.0, 1.0);\n\nbool f(float a, float b) {\n  return abs(a - b) < 1e-4;\n}\n\nbool q(vec2 a) {\n  return a.x >= 0.0 && a.y >= 0.0 && a.x <= 1.0 && a.y <= 1.0;\n}\n\nvec4 m() {\n  return vec4(-1.0, -1.0, -1.0, -1.0);\n}\n\nvec2 t(const vec4 a) {\n  return vec2(a.z, a.w);\n}\n\nbool i(const vec4 a) {\n  return!f(a.y, -1.0);\n}\n\nfloat u(vec2 a, vec2 b, vec2 c) {\n  float d = min(abs(a.x - b.x), c.x - abs(a.x - b.x)), g = min(abs(a.y - b.y), c.y - abs(a.y - b.y));\n  return sqrt(d * d + g * g);\n}\n\nvec4 e(const vec4 b, const vec2 z) {\n  vec2 c = (gl_FragCoord.xy + z) / iCellGridSize;\n  vec4 a = texture2D(iCellGridTexture, c);\n  a = !q(c) && !iUseTorusDistanceForSeeds ? m() : a;\n  if (!i(a))\n    return b;\n  else if (!i(b))\n    return a;\n  else {\n    vec2 d = t(b), g = t(a);\n    if (iUseTorusDistanceForSeeds) {\n      if (u(d, gl_FragCoord.xy, iCellGridSize) > u(g, gl_FragCoord.xy, iCellGridSize))\n        return a;\n    }\n    else if (distance(d, gl_FragCoord.xy) > distance(g, gl_FragCoord.xy))\n      return a;\n  }\n  return b;\n}\n\nvoid main() {\n  vec2 b = gl_FragCoord.xy / iCellGridSize;\n  vec4 a = texture2D(iCellGridTexture, b);\n  a = e(a, vec2(0, iStepSize)), a = e(a, vec2(iStepSize, iStepSize)), a = e(a, vec2(iStepSize, 0)), a = e(a, vec2(iStepSize, -iStepSize)), a = e(a, vec2(0, -iStepSize)), a = e(a, vec2(-iStepSize, -iStepSize)), a = e(a, vec2(-iStepSize, 0)), a = e(a, vec2(-iStepSize, iStepSize)), gl_FragColor = a;\n}\n'),
this.d=new Igloo.Program(this.b.gl,'precision highp float;\n\nconst vec4 o = vec4(1.0, 0.0, 0.0, 1.0), j = vec4(0.0, 1.0, 0.0, 1.0), l = vec4(0.0, 0.0, 1.0, 1.0), k = vec4(0.0, 1.0, 1.0, 1.0), r = vec4(1.0, 0.0, 1.0, 1.0), n = vec4(1.0, 1.0, 0.0, 1.0), h = vec4(0.0, 0.0, 0.0, 1.0), p = vec4(1.0, 1.0, 1.0, 1.0);\nattribute vec2 quad;\n\nvoid main() {\n  gl_Position = vec4(quad, 0, 1.0);\n}\n','precision highp float;\n\nuniform sampler2D iCellGridTexture;\nuniform vec2 iCellGridSize;\nuniform vec4 iBackgroundColor;\nconst vec4 o = vec4(1.0, 0.0, 0.0, 1.0), j = vec4(0.0, 1.0, 0.0, 1.0), l = vec4(0.0, 0.0, 1.0, 1.0), k = vec4(0.0, 1.0, 1.0, 1.0), r = vec4(1.0, 0.0, 1.0, 1.0), n = vec4(1.0, 1.0, 0.0, 1.0), h = vec4(0.0, 0.0, 0.0, 1.0), p = vec4(1.0, 1.0, 1.0, 1.0);\n\nint s(int a, int b) {\n  return a * 256 + b;\n}\n\nbool f(float a, float b) {\n  return abs(a - b) < 1e-4;\n}\n\nbool y(vec4 a, vec4 b) {\n  return f(a.x, b.x) && f(a.y, b.y) && f(a.z, b.z) && f(a.w, b.w);\n}\n\nvec4 B(float a, float b, vec2 c) {\n  return vec4(a, b, c);\n}\n\nvec4 m() {\n  return vec4(-1.0, -1.0, -1.0, -1.0);\n}\n\nvoid main() {\n  vec2 b = gl_FragCoord.xy / iCellGridSize, c = vec2(b.x, 1.0 - b.y);\n  vec4 a = texture2D(iCellGridTexture, c);\n  if (y(a, iBackgroundColor))\n    gl_FragColor = m();\n  else {\n    int d = s(int(a.r * 255.0), int(a.g * 255.0)), g = s(int(a.b * 255.0), int(a.a * 255.0));\n    gl_FragColor = B(float(d), float(g), gl_FragCoord.xy);\n  }\n}\n'),
this.h=this.b.array(Igloo.QUAD2),this.f=this.b.texture(null,6408,10497,9728,5126).blank(this.c,this.c),this.j=this.b.texture(null,6408,10497,9728,5126).blank(this.c,this.c),this.l=this.b.texture(null,6408,10497,9728,5121).blank(this.c,this.c),this.m=this.b.framebuffer()}function za(a,b){this.a=a,this.b=b}function ua(a){this.a=a}function ya(){this.a=!1}var na=[i(7667884),i(14373119),i(5046527),i(9651967),i(10042034),i(4150527),i(233724),i(16777215)],Y=[i(7051762),i(4814543),i(8428277),i(8305894),i(9011445),i(970239),i(5611513)];pa()})();
