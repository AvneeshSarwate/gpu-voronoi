(function(){var qa=Math.imul||function(a,b){return (a*(b>>>16)<<16)+a*(b&65535)|0};var G;function W(a){for(var b=window.location.search.substring(1),c=b.split('&'),d=0;d<c.length;d=d+1|0){var e=c[d].split('=');if(e[0]===a)return e[1]}return null}function p(a,b,c,d){var e=a.getElementsByClassName(b)[0];return e.width=e.height=c,e.style.width=e.style.height=d+'px',e}function v(a,b){var c=null;try{c=new za(a,b)}catch(d){document.getElementById('demo-page').style.display='none',document.getElementById('webgl-error').style.display=null;throw d}return c}function r(a,b){var c=a.getBoundingClientRect();return new Ba(b.a/c.width*a.width,b.b/c.height*a.height)}function s(a,b){return r(a,new Ba(b.offsetX,b.offsetY))}function X(a,b){var c=p(a,'input-canvas',b<<8,256),d=p(a,'output-canvas',b<<8,256),e=new Aa,h=v(d,e);new sa(c,d,function(){z(h,c),A(h),y(h)})}function Y(a,b){var c=p(a,'input-canvas',b<<8,256),d=p(a,'output-canvas',b<<8,256),e=new Aa;e.a=!0;var h=v(d,e);new ua(c,d,function(){z(h,c),A(h),y(h)})}function Z(a,b){
var c=p(a,'input-canvas',b<<8,256),d=p(a,'output-canvas',b<<8,256),e=new Aa,h=v(d,e);new xa(c,d,function(f){z(h,f.d),A(h),y(h)})}function ra(){window.onload=function(){var a=2;try{var b=W('antialiasingFactor');b!=null&&(a=parseInt(b,10))}catch(c){}X(document.getElementById('paint-demo-container'),a),Y(document.getElementById('fish-demo-container'),a),Z(document.getElementById('photo-demo-container'),a)}}function da(a,b){var c=a.getExtension(b);if(!c)throw new Error('Unsupported WebGL extension with name '+b);return c}function ea(a){return a!=0&&(a&a-1)==0}function O(a,b){return a-b*Math.floor(a/b)}function w(b,a){a.a>0&&a.b>0&&a.a<b.a.width&&a.b<b.a.height&&(b.d=new ya(.5+Math.random()*.4,.2,.3+Math.random()*.5,1),b.c.beginPath(),b.c.rect(a.a-b.h|0,a.b-b.h|0,b.h<<1,b.h<<1),b.c.fillStyle=N(b.d),b.c.fill(),b.f&&b.f())}function H(b,a){a.beginPath(),a.rect(b.a.a-(b.b/2|0)|0,b.a.b-(b.b/2|0)|0,b.b,b.b),a.fillStyle=N(b.c),a.fill(),a.closePath()}function $(e){var a=null,b=function(){var c=new Date,d=a?+c-+a:1/30;aa(e,
d/1000),a=c,requestAnimationFrame(b)};requestAnimationFrame(b)}function aa(e,a){e.c.clearRect(0,0,e.a.width,e.a.height);for(var b=1,h=e.h.length;b<h;b=b+1|0){var c=e.h[b];c.a.a+=e.f[b]*a,c.a.b-=e.f[b]*a,ia(c.a,new Ba(e.a.width,e.a.height))}for(var f=0,j=e.h,l=j.length;f<l;f=f+1|0){var d=j[f];H(d,e.c)}H(e.j,e.c),e.d&&e.d()}function I(d){ca(d.a);for(var a=la(q(d.d,d.e)),e=0,h=d.b,f=h.length;e<f;e=e+1|0){var b=h[e],c=P(b);ja(c,Math.max(u(q(d.e,d.d))/50*2,.5)),c=ka(c,a),ha(c,r(d.a.a,d.e)),ba(d,c)}x(d),d.a.l(d.a)}function x(e){var a=r(e.a.a,e.d),b=r(e.a.a,e.e);e.a.c.beginPath(),e.a.c.moveTo(a.a|0,a.b|0),e.a.c.lineTo(b.a|0,b.b|0),e.a.c.strokeStyle='#8AC7F5',e.a.c.stroke();var c='#DDD',d='#DDD';u(q(e.h,e.d))<11?d=e.c?'#999':'#FFF':u(q(e.h,e.e))<18&&(c=e.c?'#999':'#FFF'),J(e,a,d,8),J(e,b,c,15)}function J(e,a,b,c){var d=e.a.c;d.beginPath(),d.arc(a.a,a.b,c,0,6.283185307179586),d.fillStyle=b,d.fill(),d.lineWidth=4,d.strokeStyle='#4763FF',d.stroke()}function K(c,a){switch(c.c.a){case 0:var b=q(c.d,c.e);c.e=new Ba(a.offsetX,
a.offsetY),c.d=ga(c.e,b);break;case 1:c.d=new Ba(a.offsetX,a.offsetY);break}I(c)}function ba(c,a){var b=c.a.d.width;a.a>0&&a.b>0&&a.a<b&&a.b<b&&M(c.a,a)}function L(e,a,b,c,d){a.beginPath(),a.rect(b.a|0,b.b|0,d,d),a.fillStyle=c,a.fill()}function ca(a){a.c.clearRect(0,0,a.a.width,a.a.height),a.e.clearRect(0,0,a.d.width,a.d.height)}function M(b,a){L(b,b.c,a,'rgba(255, 255, 255, 0.5)',4),L(b,b.e,a,b.f,1)}function N(a){return 'rgba('+(a.a*255|0)+', '+(a.b*255|0)+', '+(a.c*255|0)+', '+a.d+')'}function i(a){return new ya((a>>16&255)/255|0,(a>>8&255)/255,(a&255)/255,1)}function y(a){a.b.defaultFramebuffer.bind(),a.j.bind(0),a.b.gl.viewport(0,0,a.o.width,a.o.height),a.n.use().attrib('quad',a.h,2).uniformi('iCellGridTexture',0).uniform('iCanvasSize',new Float32Array([a.o.width,a.o.height])).uniform('iGridSize',new Float32Array([a.c,a.c])).uniform('iRelease',!0,!0).draw(5,4)}function z(b,a){b.m.attach(b.f),b.l.set(a,null,null),b.l.bind(0),b.b.gl.viewport(0,0,b.c,b.c),b.e.use().attrib('quad',b.h,2).uniformi('iCellGridTexture',
0).uniform('iCellGridSize',new Float32Array([b.c,b.c])).uniform('iBackgroundColor',new Float32Array([0,0,0,0])).draw(5,4)}function A(b){for(var a=b.c/2|0;a>0;)B(b,a),a=a/2|0;B(b,2),B(b,1)}function B(b,a){b.m.attach(b.j),b.f.bind(0),b.b.gl.viewport(0,0,b.c,b.c),b.d.use().attrib('quad',b.h,2).uniformi('iCellGridTexture',0).uniformi('iStepSize',a).uniform('iCellGridSize',new Float32Array([b.c,b.c])).uniformi('iUseTorusDistanceForSeeds',b.a.a?1:0).draw(5,4),fa(b)}function fa(b){var a=b.f;b.f=b.j,b.j=a}function ga(b,a){return new Ba(b.a+a.a,b.b+a.b)}function q(b,a){return new Ba(b.a-a.a,b.b-a.b)}function ha(b,a){b.a+=a.a,b.b+=a.b}function ia(b,a){b.a=O(b.a,a.a),b.b=O(b.b,a.b)}function ja(b,a){b.a*=a,b.b*=a}function ka(b,a){return new Ba(b.a*Math.cos(a)-b.b*Math.sin(a),b.b*Math.cos(a)+b.a*Math.sin(a))}function la(a){return Math.atan2(a.b,a.a)}function u(a){return Math.sqrt(a.a*a.a+a.b*a.b)}function P(a){return new Ba(a.a,a.b)}function k(a,b,c){a.addEventListener(b,c)}function t(a){try{return a.getContext('2d')}catch(b){}
return null}function sa(a,b,c){var g=this;g.c=g.d=null,g.e=0,g.h=2,g.a=a,g.b=b,g.f=c,g.a.style.backgroundColor='white',g.c=t(g.a),k(document,'keyup',function(d){d.which^67||(g.e=(g.e+1|0)%pa.length|0)});var e=!1;k(document,'mousedown',function(h){e=!0,w(g,s(g.a,h))});for(var n=0,o=[g.a,g.b],F=o.length;n<F;n=n+1|0){var f=o[n];k(f,'mousemove',function(j){e&&w(g,s(g.a,j))})}k(document,'mouseup',function(l){e=!1}),k(document,'mouseleave',function(m){e=!1}),w(g,new Ba(g.a.width/2|0,g.a.height/2|0))}function ta(a){this.a=a,this.b=4,this.c=new ya(0,0,1,1)}function ua(a,b,c){var f=this;f.a=f.b=f.c=f.d=null,f.e=40,f.h=[],f.f=[],f.j=null,f.a=a,f.b=b,f.d=c,f.c=t(f.a);for(var d=1,j=f.e;d<j;d=d+1|0)f.h.push(new ta(new Ba(Math.random()*f.a.width,Math.random()*f.a.height))),f.h[f.h.length-1|0].c=_[d%_.length|0],f.f.push(15+Math.random()*8);f.j=new ta(new Ba(Math.random()*f.a.width,Math.random()*f.a.height)),f.j.c=i(16771345);for(var l=0,m=[f.a,f.b],g=m.length;l<g;l=l+1|0){var e=m[l];k(e,'mousemove',function(h){f.j.a=s(e,h)})}
$(f)}function va(a){this.a=null,this.b=[],this.c=null,this.d=new Ba(0,0),this.e=new Ba(0,0),this.h=new Ba(0,0),this.a=a;var b=this.a.a.getBoundingClientRect(),c=new Ba(b.width,b.height);this.e=new Ba(c.a/2,c.b/2),this.d=P(this.e),this.d.b-=50;for(var d=0;d<20;d=d+1|0)for(var e=qa(d,d),h=0;h<10;h++){var f=e*Math.cos(h/10*3.141592653589793*2),j=e*Math.sin(h/10*3.141592653589793*2);f+=Math.random()*30-15,j+=Math.random()*30-15,this.b.push(new Ba(f,j))}I(this)}G=va.prototype;G.T=function(a){this.h=new Ba(a.offsetX,a.offsetY);var b=new Ba(a.offsetX,a.offsetY);this.c=u(q(this.d,b))<11?new wa(1):new wa(0),a.stopPropagation(),K(this,a)};G.U=function(a){this.h=new Ba(a.offsetX,a.offsetY),this.c?K(this,a):x(this),a.stopPropagation()};G.V=function(a){M(this.a,s(this.a.a,a)),this.c=null,this.h=new Ba(a.offsetX,a.offsetY),x(this),a.stopPropagation()};function xa(a,b,c){var g=this;g.a=g.b=g.c=g.d=g.e=g.h=g.f=null,g.j=!1,g.l=null,g.m=[],g.a=a,g.b=b,g.l=c,g.c=t(g.a),g.d=document.createElement('canvas'),g.e=t(g.d),g.d.width=g.a.width,
g.d.height=g.a.height,g.h=document.getElementById('eye'),g.f=g.e.createPattern(g.h,'repeat');for(var E=0,S=[g.a,g.b],oa=S.length;E<oa;E=E+1|0){var d=S[E];k(d,'mousedown',function(e){for(var n=0,o=g.m,F=o.length;n<F;n=n+1|0){var h=o[n];h.T(e)}}),k(d,'mousemove',function(f){for(var C=0,Q=g.m,ma=Q.length;C<ma;C=C+1|0){var j=Q[C];j.U(f)}}),k(d,'mouseup',function(l){for(var D=0,R=g.m,na=R.length;D<na;D=D+1|0){var m=R[D];m.V(l)}})}g.m=[new va(g)]}function ya(a,b,c,d){this.a=a,this.b=b,this.c=c,this.d=d}function za(a,b){if(this.a=this.b=null,this.c=0,this.d=this.e=this.h=this.f=this.j=this.l=this.m=this.g=this.n=this.o=null,a.width^a.height)throw new Error('JumpFlood canvas parameter must be square. Size is ('+a.width+', '+a.height+')');if(!ea(a.width))throw new Error('JumpFlood canvas size must be a power of two. Size is '+a.width);if(this.a=b,this.c=a.width,this.o=a,this.b=new Igloo(a),!this.b.gl)throw new Error('Failed to initialize Igloo');this.b.gl.disable(2929),this.n=new Igloo.Program(this.b.gl,'precision highp float;\n\nconst vec4 o = vec4(1.0, 0.0, 0.0, 1.0), j = vec4(0.0, 1.0, 0.0, 1.0), l = vec4(0.0, 0.0, 1.0, 1.0), k = vec4(0.0, 1.0, 1.0, 1.0), r = vec4(1.0, 0.0, 1.0, 1.0), n = vec4(1.0, 1.0, 0.0, 1.0), h = vec4(0.0, 0.0, 0.0, 1.0), p = vec4(1.0, 1.0, 1.0, 1.0);\nattribute vec2 quad;\n\nvoid main() {\n  gl_Position = vec4(quad, 0, 1.0);\n}\n',
'precision highp float;\n\nuniform sampler2D iCellGridTexture;\nuniform vec2 iGridSize, iCanvasSize;\nuniform int iRelease;\nconst vec4 o = vec4(1.0, 0.0, 0.0, 1.0), j = vec4(0.0, 1.0, 0.0, 1.0), l = vec4(0.0, 0.0, 1.0, 1.0), k = vec4(0.0, 1.0, 1.0, 1.0), r = vec4(1.0, 0.0, 1.0, 1.0), n = vec4(1.0, 1.0, 0.0, 1.0), h = vec4(0.0, 0.0, 0.0, 1.0), p = vec4(1.0, 1.0, 1.0, 1.0);\n\nint C(int a, int b) {\n  return int(mod(float(a), float(b)));\n}\n\nvec2 w(int a) {\n  return vec2(a / 256, C(a, 256));\n}\n\nbool f(float a, float b) {\n  return abs(a - b) < 1e-4;\n}\n\nbool v(vec2 a, vec2 b, vec2 c) {\n  return a.x > b.x && a.x < c.x && a.y > b.y && a.y < c.y;\n}\n\nvec2 A(vec2 b) {\n  vec2 a = gl_FragCoord.xy / iCanvasSize;\n  return vec2(0.0, 0.0) + iGridSize * a;\n}\n\nbool q(vec2 a) {\n  return a.x >= 0.0 && a.y >= 0.0 && a.x <= 1.0 && a.y <= 1.0;\n}\n\nvec4 D(const vec4 a) {\n  int b = int(a.x), c = int(a.y);\n  return vec4(w(b), w(c)) / 255.0;\n}\n\nbool i(const vec4 a) {\n  return!f(a.y, -1.0);\n}\n\nvoid x(vec2 a) {\n  if (iRelease == 1)\n    return;\n  vec4 b = vec4(1.0, 0.5, 0.5, 1.0), c = vec4(0.5, 0.5, 1.0, 1.0), d = vec4(0.5, 1.0, 0.5, 1.0);\n  if (mod(a.x, 100.0) < 3.0 || mod(a.y, 100.0) < 3.0)\n    gl_FragColor = (b + gl_FragColor) / 2.0;\n  if (v(a.xy, vec2(0.0, 0.0), vec2(10.0, 10.0)))\n    gl_FragColor = (d + gl_FragColor) / 2.0;\n  if (v(a.xy, vec2(100.0, 100.0), vec2(110.0, 110.0)))\n    gl_FragColor = (c + gl_FragColor) / 2.0;\n}\n\nvoid main() {\n  vec2 a = A(gl_FragCoord.xy), b = a / iGridSize;\n  if (!q(b)) {\n    gl_FragColor = h, x(a);\n    return;\n  }\n  vec4 c = texture2D(iCellGridTexture, b);\n  if (!i(c))\n    discard;\n  else\n    gl_FragColor = D(c);\n}\n');
var c=this.b.gl;da(c,'OES_texture_float'),c.disable(2929),this.d=new Igloo.Program(this.b.gl,'precision highp float;\n\nconst vec4 o = vec4(1.0, 0.0, 0.0, 1.0), j = vec4(0.0, 1.0, 0.0, 1.0), l = vec4(0.0, 0.0, 1.0, 1.0), k = vec4(0.0, 1.0, 1.0, 1.0), r = vec4(1.0, 0.0, 1.0, 1.0), n = vec4(1.0, 1.0, 0.0, 1.0), h = vec4(0.0, 0.0, 0.0, 1.0), p = vec4(1.0, 1.0, 1.0, 1.0);\nattribute vec2 quad;\n\nvoid main() {\n  gl_Position = vec4(quad, 0, 1.0);\n}\n','precision highp float;\n\nuniform sampler2D iCellGridTexture;\nuniform vec2 iCellGridSize;\nuniform int iStepSize;\nuniform bool iUseTorusDistanceForSeeds;\nconst vec4 o = vec4(1.0, 0.0, 0.0, 1.0), j = vec4(0.0, 1.0, 0.0, 1.0), l = vec4(0.0, 0.0, 1.0, 1.0), k = vec4(0.0, 1.0, 1.0, 1.0), r = vec4(1.0, 0.0, 1.0, 1.0), n = vec4(1.0, 1.0, 0.0, 1.0), h = vec4(0.0, 0.0, 0.0, 1.0), p = vec4(1.0, 1.0, 1.0, 1.0);\n\nbool f(float a, float b) {\n  return abs(a - b) < 1e-4;\n}\n\nbool q(vec2 a) {\n  return a.x >= 0.0 && a.y >= 0.0 && a.x <= 1.0 && a.y <= 1.0;\n}\n\nvec4 m() {\n  return vec4(-1.0, -1.0, -1.0, -1.0);\n}\n\nvec2 t(const vec4 a) {\n  return vec2(a.z, a.w);\n}\n\nbool i(const vec4 a) {\n  return!f(a.y, -1.0);\n}\n\nfloat u(vec2 a, vec2 b, vec2 c) {\n  float d = min(abs(a.x - b.x), c.x - abs(a.x - b.x)), g = min(abs(a.y - b.y), c.y - abs(a.y - b.y));\n  return sqrt(d * d + g * g);\n}\n\nvec4 e(const vec4 b, const vec2 z) {\n  vec2 c = (gl_FragCoord.xy + z) / iCellGridSize;\n  vec4 a = texture2D(iCellGridTexture, c);\n  a = !q(c) && !iUseTorusDistanceForSeeds ? m() : a;\n  if (!i(a))\n    return b;\n  else if (!i(b))\n    return a;\n  else {\n    vec2 d = t(b), g = t(a);\n    if (iUseTorusDistanceForSeeds) {\n      if (u(d, gl_FragCoord.xy, iCellGridSize) > u(g, gl_FragCoord.xy, iCellGridSize))\n        return a;\n    }\n    else if (distance(d, gl_FragCoord.xy) > distance(g, gl_FragCoord.xy))\n      return a;\n  }\n  return b;\n}\n\nvoid main() {\n  vec2 b = gl_FragCoord.xy / iCellGridSize;\n  vec4 a = texture2D(iCellGridTexture, b);\n  a = e(a, vec2(0, iStepSize)), a = e(a, vec2(iStepSize, iStepSize)), a = e(a, vec2(iStepSize, 0)), a = e(a, vec2(iStepSize, -iStepSize)), a = e(a, vec2(0, -iStepSize)), a = e(a, vec2(-iStepSize, -iStepSize)), a = e(a, vec2(-iStepSize, 0)), a = e(a, vec2(-iStepSize, iStepSize)), gl_FragColor = a;\n}\n'),
this.e=new Igloo.Program(this.b.gl,'precision highp float;\n\nconst vec4 o = vec4(1.0, 0.0, 0.0, 1.0), j = vec4(0.0, 1.0, 0.0, 1.0), l = vec4(0.0, 0.0, 1.0, 1.0), k = vec4(0.0, 1.0, 1.0, 1.0), r = vec4(1.0, 0.0, 1.0, 1.0), n = vec4(1.0, 1.0, 0.0, 1.0), h = vec4(0.0, 0.0, 0.0, 1.0), p = vec4(1.0, 1.0, 1.0, 1.0);\nattribute vec2 quad;\n\nvoid main() {\n  gl_Position = vec4(quad, 0, 1.0);\n}\n','precision highp float;\n\nuniform sampler2D iCellGridTexture;\nuniform vec2 iCellGridSize;\nuniform vec4 iBackgroundColor;\nconst vec4 o = vec4(1.0, 0.0, 0.0, 1.0), j = vec4(0.0, 1.0, 0.0, 1.0), l = vec4(0.0, 0.0, 1.0, 1.0), k = vec4(0.0, 1.0, 1.0, 1.0), r = vec4(1.0, 0.0, 1.0, 1.0), n = vec4(1.0, 1.0, 0.0, 1.0), h = vec4(0.0, 0.0, 0.0, 1.0), p = vec4(1.0, 1.0, 1.0, 1.0);\n\nint s(int a, int b) {\n  return a * 256 + b;\n}\n\nbool f(float a, float b) {\n  return abs(a - b) < 1e-4;\n}\n\nbool y(vec4 a, vec4 b) {\n  return f(a.x, b.x) && f(a.y, b.y) && f(a.z, b.z) && f(a.w, b.w);\n}\n\nvec4 B(float a, float b, vec2 c) {\n  return vec4(a, b, c);\n}\n\nvec4 m() {\n  return vec4(-1.0, -1.0, -1.0, -1.0);\n}\n\nvoid main() {\n  vec2 b = gl_FragCoord.xy / iCellGridSize, c = vec2(b.x, 1.0 - b.y);\n  vec4 a = texture2D(iCellGridTexture, c);\n  if (y(a, iBackgroundColor))\n    gl_FragColor = m();\n  else {\n    int d = s(int(a.r * 255.0), int(a.g * 255.0)), g = s(int(a.b * 255.0), int(a.a * 255.0));\n    gl_FragColor = B(float(d), float(g), gl_FragCoord.xy);\n  }\n}\n'),
this.h=this.b.array(Igloo.QUAD2),this.f=this.b.texture(null,6408,10497,9728,5126).blank(this.c,this.c),this.j=this.b.texture(null,6408,10497,9728,5126).blank(this.c,this.c),this.l=this.b.texture(null,6408,10497,9728,5121).blank(this.c,this.c),this.m=this.b.framebuffer()}function Ba(a,b){this.a=a,this.b=b}function wa(a){this.a=a}function Aa(){this.a=!1}var pa=[i(7667884),i(14373119),i(5046527),i(9651967),i(10042034),i(4150527),i(233724),i(16777215)],_=[i(7051762),i(4814543),i(8428277),i(8305894),i(9011445),i(970239),i(5611513)];ra()})();
